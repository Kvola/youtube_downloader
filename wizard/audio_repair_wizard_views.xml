<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Wizard : R√©paration audio intelligente
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <record id="view_audio_repair_wizard_form" model="ir.ui.view">
        <field name="name">audio.repair.wizard.form</field>
        <field name="model">audio.repair.wizard</field>
        <field name="arch" type="xml">
            <form string="üîä R√©paration audio intelligente">
                <sheet>

                    <!-- ‚ïê‚ïê √âTAPE 1 : SCAN ‚ïê‚ïê -->
                    <div invisible="state != 'scan'">
                        <div class="alert alert-info" role="alert">
                            <div class="d-flex align-items-start">
                                <span class="fs-3 me-3">üîä</span>
                                <div>
                                    <strong>R√©paration audio intelligente</strong><br/>
                                    Cet assistant va scanner <b>toutes vos vid√©os</b> (YouTube, Telegram, fichiers externes)
                                    et d√©tecter automatiquement celles dont l'audio n'est pas en AAC.<br/><br/>
                                    <b>Probl√®me typique :</b> Les fichiers MKV/WebM convertis en MP4 avec l'ancien syst√®me
                                    conservaient l'audio en Opus/Vorbis, ce qui rend le son muet dans les navigateurs.<br/><br/>
                                    <span class="badge bg-warning text-dark">‚ö†Ô∏è Le scan peut prendre quelques minutes selon le nombre de fichiers</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ‚ïê‚ïê √âTAPE 2 : R√âSULTATS ‚ïê‚ïê -->
                    <div invisible="state != 'result'">

                        <!-- Cas: Rien √† r√©parer -->
                        <div class="alert alert-success" role="alert"
                             invisible="total_count != 0">
                            <div class="d-flex align-items-start">
                                <span class="fs-3 me-3">‚úÖ</span>
                                <div>
                                    <strong>Tout est en ordre !</strong><br/>
                                    Tous vos fichiers vid√©o ont d√©j√† un audio compatible (AAC).
                                    Aucune r√©paration n'est n√©cessaire.
                                </div>
                            </div>
                        </div>

                        <!-- Cas: Fichiers √† r√©parer -->
                        <div class="alert alert-warning" role="alert"
                             invisible="total_count == 0">
                            <div class="d-flex align-items-start">
                                <span class="fs-3 me-3">‚ö†Ô∏è</span>
                                <div>
                                    <strong><field name="total_count" readonly="1"/> fichier(s) avec un audio incompatible d√©tect√©(s)</strong><br/>
                                    L'audio sera r√©-encod√© en AAC (compatible tous navigateurs).
                                    La vid√©o ne sera <b>pas</b> r√©-encod√©e (rapide).
                                </div>
                            </div>
                        </div>

                        <!-- Statistiques -->
                        <group>
                            <group string="üìä R√©sultat du scan">
                                <div class="row mb-2" invisible="youtube_count == 0">
                                    <div class="col-8"><b>üé¨ YouTube</b></div>
                                    <div class="col-4">
                                        <span class="badge bg-danger"><field name="youtube_count" readonly="1"/> √† r√©parer</span>
                                    </div>
                                </div>
                                <div class="row mb-2" invisible="external_count == 0">
                                    <div class="col-8"><b>üìÇ M√©dias externes</b></div>
                                    <div class="col-4">
                                        <span class="badge bg-danger"><field name="external_count" readonly="1"/> √† r√©parer</span>
                                    </div>
                                </div>
                                <div class="row mb-2" invisible="telegram_count == 0">
                                    <div class="col-8"><b>üì± Telegram</b></div>
                                    <div class="col-4">
                                        <span class="badge bg-danger"><field name="telegram_count" readonly="1"/> √† r√©parer</span>
                                    </div>
                                </div>
                            </group>
                            <group string="‚úÖ D√©j√† OK">
                                <div class="row mb-2">
                                    <div class="col-8">Audio AAC (aucune action)</div>
                                    <div class="col-4">
                                        <span class="badge bg-success"><field name="already_ok_count" readonly="1"/></span>
                                    </div>
                                </div>
                                <div class="row mb-2" invisible="no_audio_count == 0">
                                    <div class="col-8">Sans piste audio</div>
                                    <div class="col-4">
                                        <span class="badge bg-secondary"><field name="no_audio_count" readonly="1"/></span>
                                    </div>
                                </div>
                            </group>
                        </group>

                        <!-- D√©tails -->
                        <separator string="üìã D√©tails des fichiers d√©tect√©s"/>
                        <field name="scan_details" readonly="1" nolabel="1"
                               widget="text"
                               style="min-height: 150px; max-height: 300px; font-family: monospace; font-size: 12px; background: #f8f9fa; overflow-y: auto;"/>
                    </div>

                    <!-- ‚ïê‚ïê √âTAPE 3 : TERMIN√â ‚ïê‚ïê -->
                    <div invisible="state != 'done'">
                        <div class="alert alert-success" role="alert">
                            <div class="d-flex align-items-start">
                                <span class="fs-3 me-3">üöÄ</span>
                                <div>
                                    <strong>R√©paration lanc√©e !</strong><br/>
                                    Les conversions audio tournent en arri√®re-plan.<br/>
                                    Vous recevrez une <b>notification en temps r√©el</b> quand tout sera termin√©.<br/>
                                    Chaque fichier r√©par√© aura un message dans son historique.
                                </div>
                            </div>
                        </div>
                    </div>

                    <field name="state" invisible="1"/>
                </sheet>

                <footer>
                    <!-- Boutons √©tape SCAN -->
                    <button name="action_scan"
                            string="üîç Lancer le scan"
                            type="object"
                            class="btn-primary"
                            invisible="state != 'scan'"/>

                    <!-- Boutons √©tape RESULT -->
                    <button name="action_repair"
                            string="üîß R√©parer tout"
                            type="object"
                            class="btn-primary"
                            invisible="state != 'result' or total_count == 0"/>
                    <button name="action_scan"
                            string="üîÑ Re-scanner"
                            type="object"
                            class="btn-secondary"
                            invisible="state != 'result'"/>

                    <!-- Bouton fermer -->
                    <button string="Fermer" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action pour ouvrir le wizard -->
    <record id="action_audio_repair_wizard" model="ir.actions.act_window">
        <field name="name">üîä R√©paration audio intelligente</field>
        <field name="res_model">audio.repair.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

</odoo>
